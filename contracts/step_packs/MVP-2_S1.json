{
  "task_kind": "step",
  "task_id": "MVP-2",
  "run_id": "MVP-2_20260224T162739Z_ctrl",
  "step_id": "S1",
  "step_title": "S2-aligned P0/templates/evo scaffolding (frontend integrator scope only)",
  "step_description": "Create the S2 file set (README Start Here + issue/PR templates + rework ticket + evo scaffolding + orchestrator_pack update) in this repo using a strict file scope. This StepPack is inferred from sibling repo `workflow/contracts/Contract-BOOTSTRAP.md` section `S2` because no local MVP-2/S2 contract was found in `workflow__ctrl`.",
  "objective": "Provide Codex A with an auditable, narrow-scope StepPack to realize the S2 scaffolding file set for MVP-2 and capture evidence for file/content checks plus S2 gate preflight (`scripts/verify.sh contract` availability).",
  "phase": "Phase 1 (user-requested) / StepPack dispatch prep",
  "step_pack_version": "1.0",
  "controller_role": "Codex B Controller+Judge",
  "source_of_s2_requirements": {
    "type": "inference",
    "source_path": "E:/Code/workflow/contracts/Contract-BOOTSTRAP.md",
    "source_section": "S2 — Add P0 + templates + evo scaffolding (Claude 接入)",
    "note": "No local `MVP-2` / `S2` specification text was found in `E:/Code/workflow__ctrl` at dispatch time."
  },
  "allowed_paths": [
    "README.md",
    ".github/ISSUE_TEMPLATE/behavior.yml",
    ".github/pull_request_template.md",
    "docs/workstream/rework_ticket.md",
    "docs/workstream/orchestrator_pack.md",
    "evo/00_index.md",
    "evo/lessons.log"
  ],
  "forbidden_paths": [
    ".artifacts/**",
    "contracts/**",
    "orchestrator/**",
    "progress/**",
    "tests/**",
    "scripts/**",
    ".github/workflows/**",
    "pyproject.toml",
    "requirements*.txt",
    "poetry.lock",
    "uv.lock",
    "package.json",
    "package-lock.json",
    "pnpm-lock.yaml",
    "yarn.lock"
  ],
  "dependency_policy": {
    "mode": "no-new-dependencies",
    "allow_new_dependencies": false,
    "allow_lockfile_changes": false,
    "allow_dependency_manifest_changes": false,
    "allow_ci_changes": false,
    "change_order_required": [
      "new dependency",
      "lockfile or dependency manifest change",
      "any scripts/** changes (including adding scripts/verify.sh)",
      "any .github/workflows/** changes",
      "expanding allowed_paths beyond the 7 S2 target files"
    ]
  },
  "scope": {
    "allowed_paths": [
      "README.md",
      ".github/ISSUE_TEMPLATE/behavior.yml",
      ".github/pull_request_template.md",
      "docs/workstream/rework_ticket.md",
      "docs/workstream/orchestrator_pack.md",
      "evo/00_index.md",
      "evo/lessons.log"
    ],
    "forbidden_paths": [
      ".artifacts/**",
      "contracts/**",
      "orchestrator/**",
      "progress/**",
      "tests/**",
      "scripts/**",
      ".github/workflows/**",
      "pyproject.toml",
      "requirements*.txt",
      "poetry.lock",
      "uv.lock",
      "package.json",
      "package-lock.json",
      "pnpm-lock.yaml",
      "yarn.lock"
    ],
    "dependency_policy": {
      "mode": "no-new-dependencies",
      "allow_new_dependencies": false,
      "allow_lockfile_changes": false,
      "allow_dependency_manifest_changes": false,
      "allow_ci_changes": false,
      "change_order_required": [
        "new dependency",
        "lockfile or dependency manifest change",
        "any scripts/** changes (including adding scripts/verify.sh)",
        "any .github/workflows/** changes",
        "expanding allowed_paths beyond the 7 S2 target files"
      ]
    }
  },
  "preconditions": [
    {
      "id": "P1_s2_gate_script",
      "description": "S2 source contract gate is `./scripts/verify.sh contract`, but `scripts/verify.sh` is not present in this repo at dispatch time.",
      "worker_instruction": "Record preflight evidence for script availability. Do not modify `scripts/**` in this step. If user wants S2 contract gate execution in this repo, request Change Order / prior step to add scripts.",
      "controller_expected_if_missing": "Scaffolding AC may still pass for this StepPack; downstream full S2 gate remains blocked until scripts exist."
    }
  ],
  "commands": [
    "rg --files README.md .github docs/workstream evo",
    "python -c '<required verification command from commands_to_run>'",
    "git status --short",
    "git diff --name-only",
    "bash ./scripts/verify.sh contract  # optional: only if scripts/verify.sh exists and is executable",
    "git add -- README.md .github/ISSUE_TEMPLATE/behavior.yml .github/pull_request_template.md docs/workstream/rework_ticket.md docs/workstream/orchestrator_pack.md evo/00_index.md evo/lessons.log",
    "git commit -m \"<cp-exec commit message>\""
  ],
  "commands_to_run": [
    "python -c 'from pathlib import Path; req=[\"README.md\",\".github/ISSUE_TEMPLATE/behavior.yml\",\".github/pull_request_template.md\",\"docs/workstream/rework_ticket.md\",\"docs/workstream/orchestrator_pack.md\",\"evo/00_index.md\",\"evo/lessons.log\"]; missing=[p for p in req if not Path(p).exists()]; print({\"missing\": missing}); raise SystemExit(1 if missing else 0)'",
    "python -c 'from pathlib import Path; t=Path(\"README.md\").read_text(encoding=\"utf-8\").lower(); ok=(\"start here\" in t and (\"tier2\" in t or \"tier 2\" in t or \"档位二\" in t) and (\"tier3\" in t or \"tier 3\" in t or \"档位三\" in t) and (\"minimal success path\" in t or \"最小成功路径\" in t)); print({\"path\":\"README.md\",\"ok\":ok}); raise SystemExit(0 if ok else 1)'",
    "python -c 'from pathlib import Path; t=Path(\".github/ISSUE_TEMPLATE/behavior.yml\").read_text(encoding=\"utf-8\").lower(); ok=all(s in t for s in [\"name:\",\"description:\",\"body:\"]); print({\"path\":\".github/ISSUE_TEMPLATE/behavior.yml\",\"ok\":ok}); raise SystemExit(0 if ok else 1)'",
    "python -c 'from pathlib import Path; t=Path(\".github/pull_request_template.md\").read_text(encoding=\"utf-8\"); tl=t.lower(); ok=((\"run_id\" in tl or \"run id\" in tl) and (\"contract\" in tl) and ((\"gate summary\" in tl) or (\"gate_summary\" in tl))); print({\"path\":\".github/pull_request_template.md\",\"ok\":ok}); raise SystemExit(0 if ok else 1)'",
    "python -c 'from pathlib import Path; rw=Path(\"docs/workstream/rework_ticket.md\").read_text(encoding=\"utf-8\").lower(); op=Path(\"docs/workstream/orchestrator_pack.md\").read_text(encoding=\"utf-8\").lower(); e0=Path(\"evo/00_index.md\").read_text(encoding=\"utf-8\").lower(); el=Path(\"evo/lessons.log\").read_text(encoding=\"utf-8\"); ok_rw=all(s in rw for s in [\"failed gate\",\"missing evidence\",\"minimal fix list\",\"re-run command\"]); ok_op=(\"fail\" in op and (\"rework ticket\" in op or \"rework\" in op)); ok_e0=(\"evo\" in e0 or \"index\" in e0); ok_el=(len(el.strip())>=0); ok=(ok_rw and ok_op and ok_e0 and ok_el is not None); print({\"rework_ticket\":ok_rw,\"orchestrator_pack\":ok_op,\"evo_index\":ok_e0,\"lessons_log_exists\":True}); raise SystemExit(0 if ok else 1)'",
    "python -c 'from pathlib import Path; p=Path(\"scripts/verify.sh\"); print({\"scripts_verify_sh_exists\": p.exists(), \"dispatch_note\": \"optional S2 gate preflight only\"})'",
    "git status --short"
  ],
  "AC": [
    "AC1: `README.md` contains a P0/Start Here entry and includes tier2/tier3 decision guidance plus a minimal success path section (keyword-level objective check).",
    "AC2: `.github/ISSUE_TEMPLATE/behavior.yml` exists and contains a usable issue template structure (`name:`, `description:`, `body:`).",
    "AC3: `.github/pull_request_template.md` exists and prompts for `RUN_ID` (or Run ID), contract reference, and Gate Summary path.",
    "AC4: `docs/workstream/rework_ticket.md`, `docs/workstream/orchestrator_pack.md`, `evo/00_index.md`, and `evo/lessons.log` exist; `rework_ticket.md` includes failed gate / missing evidence / minimal fix list / re-run command fields; `orchestrator_pack.md` explicitly states FAIL must go back via rework ticket.",
    "AC5: S2 gate preflight evidence is captured by checking `scripts/verify.sh` availability without modifying `scripts/**` in this step (downstream full S2 gate execution remains separate if script is absent).",
    "AC6: StepResult evidence is auditable (.artifacts paths, required command records, AC verification records) and all `files_changed` remain inside `allowed_paths` with no forbidden-path or dependency-policy violations."
  ],
  "gates": [
    {
      "gate_id": "G1",
      "owner": "worker",
      "type": "required_command_exit_0",
      "target_ac": [
        "AC1",
        "AC2",
        "AC3",
        "AC4"
      ],
      "command_index": 0,
      "pass_condition": "File existence check exits 0 with empty missing list."
    },
    {
      "gate_id": "G2",
      "owner": "worker",
      "type": "required_command_exit_0",
      "target_ac": [
        "AC1"
      ],
      "command_index": 1,
      "pass_condition": "README keyword check exits 0."
    },
    {
      "gate_id": "G3",
      "owner": "worker",
      "type": "required_command_exit_0",
      "target_ac": [
        "AC2"
      ],
      "command_index": 2,
      "pass_condition": "Issue template structure check exits 0."
    },
    {
      "gate_id": "G4",
      "owner": "worker",
      "type": "required_command_exit_0",
      "target_ac": [
        "AC3"
      ],
      "command_index": 3,
      "pass_condition": "PR template content check exits 0."
    },
    {
      "gate_id": "G5",
      "owner": "worker",
      "type": "required_command_exit_0",
      "target_ac": [
        "AC4"
      ],
      "command_index": 4,
      "pass_condition": "Rework/orchestrator/evo content checks exit 0."
    },
    {
      "gate_id": "G6",
      "owner": "worker",
      "type": "required_command_evidence_only",
      "target_ac": [
        "AC5"
      ],
      "command_index": 5,
      "pass_condition": "Preflight command executed and script availability status is visible in command output evidence."
    },
    {
      "gate_id": "G7",
      "owner": "controller",
      "type": "qa_scope_guard_review",
      "target_ac": [
        "AC6"
      ],
      "pass_condition": "step_result.files_changed all match allowed_paths and none match forbidden_paths."
    },
    {
      "gate_id": "G8",
      "owner": "controller",
      "type": "qa_evidence_review",
      "target_ac": [
        "AC6"
      ],
      "pass_condition": "step_result.commands_executed and verification_results evidence_path values are under .artifacts/agent_runs/ and evidence_required files exist."
    }
  ],
  "evidence_required": [
    {
      "id": "E1_step_result",
      "path_pattern": ".artifacts/agent_runs/MVP-2_20260224T162739Z_ctrl/steps/S1/rounds/R*/step_result.json",
      "required_for": [
        "AC6"
      ],
      "notes": "Canonical worker result payload for controller QA review."
    },
    {
      "id": "E2_shim_stdout",
      "path_pattern": ".artifacts/agent_runs/MVP-2_20260224T162739Z_ctrl/steps/S1/rounds/R*/shim_stdout.txt",
      "required_for": [
        "AC1",
        "AC2",
        "AC3",
        "AC4",
        "AC5",
        "AC6"
      ],
      "notes": "Required command output evidence (including scripts/verify.sh preflight output) may point here."
    },
    {
      "id": "E3_subagent_output",
      "path_pattern": ".artifacts/agent_runs/MVP-2_20260224T162739Z_ctrl/steps/S1/rounds/R*/subagent_output.md",
      "required_for": [
        "AC1",
        "AC2",
        "AC3",
        "AC4",
        "AC5",
        "AC6"
      ],
      "notes": "Worker summary with changed files, AC mapping, and any S2 precondition/blocker note."
    },
    {
      "id": "E4_command_records",
      "path_pattern": "step_result.json::commands_executed[*]",
      "required_for": [
        "AC6"
      ],
      "notes": "Must include command, exit_code, evidence_path for every commands_to_run entry."
    },
    {
      "id": "E5_verification_records",
      "path_pattern": "step_result.json::verification_results[*]",
      "required_for": [
        "AC6"
      ],
      "notes": "Must cover every AC string exactly. For PASS, all relevant ACs must be met."
    }
  ],
  "acceptance": {
    "AC": [
      "AC1: `README.md` contains a P0/Start Here entry and includes tier2/tier3 decision guidance plus a minimal success path section (keyword-level objective check).",
      "AC2: `.github/ISSUE_TEMPLATE/behavior.yml` exists and contains a usable issue template structure (`name:`, `description:`, `body:`).",
      "AC3: `.github/pull_request_template.md` exists and prompts for `RUN_ID` (or Run ID), contract reference, and Gate Summary path.",
      "AC4: `docs/workstream/rework_ticket.md`, `docs/workstream/orchestrator_pack.md`, `evo/00_index.md`, and `evo/lessons.log` exist; `rework_ticket.md` includes failed gate / missing evidence / minimal fix list / re-run command fields; `orchestrator_pack.md` explicitly states FAIL must go back via rework ticket.",
      "AC5: S2 gate preflight evidence is captured by checking `scripts/verify.sh` availability without modifying `scripts/**` in this step (downstream full S2 gate execution remains separate if script is absent).",
      "AC6: StepResult evidence is auditable (.artifacts paths, required command records, AC verification records) and all `files_changed` remain inside `allowed_paths` with no forbidden-path or dependency-policy violations."
    ],
    "gates": [
      {
        "gate_id": "G1",
        "owner": "worker",
        "type": "required_command_exit_0",
        "target_ac": [
          "AC1",
          "AC2",
          "AC3",
          "AC4"
        ],
        "command_index": 0,
        "pass_condition": "File existence check exits 0 with empty missing list."
      },
      {
        "gate_id": "G2",
        "owner": "worker",
        "type": "required_command_exit_0",
        "target_ac": [
          "AC1"
        ],
        "command_index": 1,
        "pass_condition": "README keyword check exits 0."
      },
      {
        "gate_id": "G3",
        "owner": "worker",
        "type": "required_command_exit_0",
        "target_ac": [
          "AC2"
        ],
        "command_index": 2,
        "pass_condition": "Issue template structure check exits 0."
      },
      {
        "gate_id": "G4",
        "owner": "worker",
        "type": "required_command_exit_0",
        "target_ac": [
          "AC3"
        ],
        "command_index": 3,
        "pass_condition": "PR template content check exits 0."
      },
      {
        "gate_id": "G5",
        "owner": "worker",
        "type": "required_command_exit_0",
        "target_ac": [
          "AC4"
        ],
        "command_index": 4,
        "pass_condition": "Rework/orchestrator/evo content checks exit 0."
      },
      {
        "gate_id": "G6",
        "owner": "worker",
        "type": "required_command_evidence_only",
        "target_ac": [
          "AC5"
        ],
        "command_index": 5,
        "pass_condition": "Preflight command executed and script availability status is visible in command output evidence."
      },
      {
        "gate_id": "G7",
        "owner": "controller",
        "type": "qa_scope_guard_review",
        "target_ac": [
          "AC6"
        ],
        "pass_condition": "step_result.files_changed all match allowed_paths and none match forbidden_paths."
      },
      {
        "gate_id": "G8",
        "owner": "controller",
        "type": "qa_evidence_review",
        "target_ac": [
          "AC6"
        ],
        "pass_condition": "step_result.commands_executed and verification_results evidence_path values are under .artifacts/agent_runs/ and evidence_required files exist."
      }
    ],
    "evidence_required": [
      {
        "id": "E1_step_result",
        "path_pattern": ".artifacts/agent_runs/MVP-2_20260224T162739Z_ctrl/steps/S1/rounds/R*/step_result.json",
        "required_for": [
          "AC6"
        ],
        "notes": "Canonical worker result payload for controller QA review."
      },
      {
        "id": "E2_shim_stdout",
        "path_pattern": ".artifacts/agent_runs/MVP-2_20260224T162739Z_ctrl/steps/S1/rounds/R*/shim_stdout.txt",
        "required_for": [
          "AC1",
          "AC2",
          "AC3",
          "AC4",
          "AC5",
          "AC6"
        ],
        "notes": "Required command output evidence (including scripts/verify.sh preflight output) may point here."
      },
      {
        "id": "E3_subagent_output",
        "path_pattern": ".artifacts/agent_runs/MVP-2_20260224T162739Z_ctrl/steps/S1/rounds/R*/subagent_output.md",
        "required_for": [
          "AC1",
          "AC2",
          "AC3",
          "AC4",
          "AC5",
          "AC6"
        ],
        "notes": "Worker summary with changed files, AC mapping, and any S2 precondition/blocker note."
      },
      {
        "id": "E4_command_records",
        "path_pattern": "step_result.json::commands_executed[*]",
        "required_for": [
          "AC6"
        ],
        "notes": "Must include command, exit_code, evidence_path for every commands_to_run entry."
      },
      {
        "id": "E5_verification_records",
        "path_pattern": "step_result.json::verification_results[*]",
        "required_for": [
          "AC6"
        ],
        "notes": "Must cover every AC string exactly. For PASS, all relevant ACs must be met."
      }
    ]
  },
  "runtime_policy": {
    "timeout_sec": 3600,
    "no_output_timeout_sec": 1200,
    "retry": {
      "max_attempts": 2,
      "retry_on": [
        "COMMAND_FAILED",
        "AC_NOT_MET"
      ],
      "requires_rework_pack_after_failed_attempts": true
    },
    "autonomy_level": "L1",
    "boundary_level": "B1"
  },
  "acceptance_criteria": [
    "AC1: `README.md` contains a P0/Start Here entry and includes tier2/tier3 decision guidance plus a minimal success path section (keyword-level objective check).",
    "AC2: `.github/ISSUE_TEMPLATE/behavior.yml` exists and contains a usable issue template structure (`name:`, `description:`, `body:`).",
    "AC3: `.github/pull_request_template.md` exists and prompts for `RUN_ID` (or Run ID), contract reference, and Gate Summary path.",
    "AC4: `docs/workstream/rework_ticket.md`, `docs/workstream/orchestrator_pack.md`, `evo/00_index.md`, and `evo/lessons.log` exist; `rework_ticket.md` includes failed gate / missing evidence / minimal fix list / re-run command fields; `orchestrator_pack.md` explicitly states FAIL must go back via rework ticket.",
    "AC5: S2 gate preflight evidence is captured by checking `scripts/verify.sh` availability without modifying `scripts/**` in this step (downstream full S2 gate execution remains separate if script is absent).",
    "AC6: StepResult evidence is auditable (.artifacts paths, required command records, AC verification records) and all `files_changed` remain inside `allowed_paths` with no forbidden-path or dependency-policy violations."
  ],
  "scope_guard": {
    "allowed_paths": [
      "README.md",
      ".github/ISSUE_TEMPLATE/behavior.yml",
      ".github/pull_request_template.md",
      "docs/workstream/rework_ticket.md",
      "docs/workstream/orchestrator_pack.md",
      "evo/00_index.md",
      "evo/lessons.log"
    ],
    "forbidden_paths": [
      ".artifacts/**",
      "contracts/**",
      "orchestrator/**",
      "progress/**",
      "tests/**",
      "scripts/**",
      ".github/workflows/**",
      "pyproject.toml",
      "requirements*.txt",
      "poetry.lock",
      "uv.lock",
      "package.json",
      "package-lock.json",
      "pnpm-lock.yaml",
      "yarn.lock"
    ]
  },
  "expected_outputs": [
    "S2-aligned scaffolding files added/updated only within the 7 allowed target files",
    "No dependency, lockfile, scripts/**, or CI workflow changes",
    "Preflight evidence showing whether scripts/verify.sh exists for downstream S2 contract gate execution",
    "StepResult package with auditable evidence under .artifacts/agent_runs/MVP-2_20260224T162739Z_ctrl/steps/S1/rounds/R*/"
  ],
  "evidence_requirement": "For each required command and each AC provide command/criteria, exit_code or met flag, and evidence_path under .artifacts/agent_runs/MVP-2_20260224T162739Z_ctrl/steps/S1/rounds/R*/. Include scripts/verify.sh preflight command output evidence even if script is absent.",
  "context": {
    "run_dir": ".artifacts/agent_runs/MVP-2_20260224T162739Z_ctrl",
    "controller_worktree": "E:/Code/workflow__ctrl",
    "controller_branch": "cp-ctrl",
    "controller_head": "26a1159",
    "target_exec_branch": "cp-exec",
    "source_instructions": [
      "CODEX_B_CONTROLLER_JUDGE.md"
    ],
    "dispatch_time_observations": {
      "local_mvp2_s2_spec_found": false,
      "scripts_verify_sh_exists": false
    }
  },
  "allowed_actions": [
    "create or update only the 7 allowed target files",
    "create parent directories required for allowed target files",
    "run commands listed in commands/commands_to_run",
    "stage and commit changes on execution branch"
  ]
}
